{# SPDX-License-Identifier: MIT-0 #}
{%- set _item_vars = item.vars | default({}) -%}
{%- set mise_env_effective = _item_vars.get('mise_env', mise_env_effective) -%}
{%- set mise_tools_effective = _item_vars.get('mise_tools', mise_tools_effective) -%}
{%- set mise_tasks_effective = _item_vars.get('mise_tasks', mise_tasks_effective) -%}
{%- set mise_settings_effective = _item_vars.get('mise_settings', mise_settings_effective) -%}
{%- set mise_plugins_effective = _item_vars.get('mise_plugins', mise_plugins_effective) -%}
{%- set mise_tool_alias_effective = _item_vars.get('mise_tool_alias', mise_tool_alias_effective) -%}
{%- set mise_shell_alias_effective = _item_vars.get('mise_shell_alias', mise_shell_alias_effective) -%}
{%- set mise_min_version_hard_effective = _item_vars.get('mise_min_version_hard', mise_min_version_hard_effective) -%}
{%- set mise_min_version_soft_effective = _item_vars.get('mise_min_version_soft', mise_min_version_soft_effective) -%}
{%- set mise_experimental_monorepo_root_effective = _item_vars.get('mise_experimental_monorepo_root', mise_experimental_monorepo_root_effective) -%}
{%- set mise_config_raw_effective = _item_vars.get('mise_config_raw', mise_config_raw_effective) -%}
{%- set _schema = _item_vars.get('schema_url', item.schema_url | default(mise_schema_url_effective, true)) -%}
{%- if _schema %}
# yaml-language-server: $schema={{ _schema }}

{% endif %}
{%- if mise_min_version_hard_effective or mise_min_version_soft_effective %}
min_version = {%- if mise_min_version_hard_effective %} { hard = '{{ mise_min_version_hard_effective }}' }{%- endif -%}{%- if mise_min_version_hard_effective and mise_min_version_soft_effective %}, {% endif -%}{%- if mise_min_version_soft_effective %} { soft = '{{ mise_min_version_soft_effective }}' }{%- endif %}
{%- endif %}
{%- if mise_experimental_monorepo_root_effective %}
experimental_monorepo_root = true
{%- endif %}
{% if mise_env_effective | length > 0 %}
[env]
{% for k, v in mise_env_effective.items() %}
{{ k | tojson }} = {{ v | tojson }}
{% endfor %}

{% endif %}
{% if mise_tools_effective | length > 0 %}
[tools]
{% for k, v in mise_tools_effective.items() %}
{% set tool_name = v.name if (v is mapping and 'name' in v) else k %}
{% set tool_version = v.version if (v is mapping and 'version' in v) else (v if (v is string) else 'latest') %}
{% set extra_keys = (v | dict2items | rejectattr('key', 'in', ['name', 'version']) | list) if (v is mapping) else [] %}
{% if extra_keys | length > 0 %}
{{ tool_name | tojson }} = { version = {{ tool_version | default('latest') | tojson }}{% for opt in extra_keys %}, {{ opt.key | tojson }} = {{ opt.value | tojson }}{% endfor %} }
{% else %}
{{ tool_name | tojson }} = {{ tool_version | default('latest') | tojson }}
{% endif %}
{% endfor %}

{% endif %}
{% if mise_tasks_effective | length > 0 %}
[tasks]
{% for k, v in mise_tasks_effective.items() %}
[tasks.{{ k | tojson }}]
{% for tk, tv in v.items() %}
{{ tk | tojson }} = {{ tv | tojson }}
{% endfor %}

{% endfor %}

{% endif %}
{% if mise_settings_effective | length > 0 %}
[settings]
{% for k, v in mise_settings_effective.items() %}
{{ k | tojson }} = {{ v | tojson }}
{% endfor %}

{% endif %}
{% if mise_plugins_effective | length > 0 %}
[plugins]
{% for k, v in mise_plugins_effective.items() %}
{{ k | tojson }} = {{ v | tojson }}
{% endfor %}

{% endif %}
{% if mise_tool_alias_effective | length > 0 %}
[tool_alias]
{% for tool, aliases in mise_tool_alias_effective.items() %}
[tool_alias.{{ tool | tojson }}.versions]
{% for name, val in aliases.get('versions', {}).items() %}
{{ name | tojson }} = {{ val | tojson }}
{% endfor %}

{% endfor %}

{% endif %}
{% if mise_shell_alias_effective | length > 0 %}
[shell_alias]
{% for k, v in mise_shell_alias_effective.items() %}
{{ k | tojson }} = {{ v | tojson }}
{% endfor %}

{% endif %}
{% if mise_config_raw_effective | length > 0 %}
{{ mise_config_raw_effective }}
{% endif %}
