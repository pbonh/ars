#SPDX-License-Identifier: MIT-0
---
- name: Merge config file items
  ansible.builtin.set_fact:
    mise_all_config_files: "{{ (mise_config_files_effective | default([], true)) + (mise_conf_d_fragments_effective | default([], true)) }}"

- name: Ensure parent directories exist
  ansible.builtin.file:
    path: "{{ item.path | dirname }}"
    state: directory
    mode: "{{ item.dir_mode | default('0755') }}"
    owner: "{{ item.owner | default(omit) }}"
    group: "{{ item.group | default(omit) }}"
  loop: "{{ mise_all_config_files | default([], true) }}"
  when:
    - item.path is defined
    - item.state | default('present') == 'present'

- name: Manage mise config files
  ansible.builtin.include_tasks: manage-config-block.yml
  loop: "{{ mise_all_config_files }}"
  loop_control:
    loop_var: item
    label: "{{ item.path }}"
